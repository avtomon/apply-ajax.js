"use strict";var __awaiter=this&&this.__awaiter||function(t,e,n,s){return new(n||(n=Promise))(function(a,i){function r(t){try{o(s.next(t))}catch(t){i(t)}}function c(t){try{o(s.throw(t))}catch(t){i(t)}}function o(t){t.done?a(t.value):new n(function(e){e(t.value)}).then(r,c)}o((s=s.apply(t,e||[])).next())})};export var Templater;!function(t){class e{constructor(t={}){this._HIDE_CLASS="",this._ALLOWED_ATTRS=[],this._DEFAULT_ERROR_CALLBACK=null,this._DEFAULT_HEADERS=null,this._DEFAULT_PARAMS={},this.data={},Object.keys(e.defaultSettings).forEach(function(n){this[n]=t[n]||e.defaultSettings[n]},this)}static isJson(t){try{if(JSON.parse(t)instanceof Object)return!0}catch(t){}return!1}request(t,e,n,s,a,i){return __awaiter(this,void 0,void 0,function*(){if(!t)return new Error("URL запроса не задан");let r=this,c=new URL(t),o=e instanceof FormData?e:new URLSearchParams(Object.assign({},this._DEFAULT_PARAMS,e));"GET"===n&&(Object.keys(o).forEach(t=>c.searchParams.append(t,o[t])),o=null);let l=a||this._DEFAULT_ERROR_CALLBACK,u=Object.assign({},this._DEFAULT_HEADERS,{method:n,body:o,credentials:"include",headers:new Headers({hash:location.hash.replace("#",""),"X-REQUESTED-WITH":"xmlhttprequest"})},i);return fetch(c.toString(),u).then(function(t){return t.json().then(function(t){r.data=t,void 0!==t.error?l(t.error):t.redirect?window.location=t.redirect:s?s(t):alert("Запрос успешно выполнен")}),t},function(t){return l(`Произошла ошибка: ${t.message}`),t})})}ajaxSubmit(t,e,n,s,a){let i=this;return new Promise(function(n,s){return __awaiter(this,void 0,void 0,function*(){let a=new FormData(t);!e||(yield e(a))?n(a):s(null)})}).then(function(e){let r=i.request(t.action,e,"POST",n,s);return r.then(a),r},function(t){return t?(s(t.message),t):null})}modifyElement(t,e,n){if(t.classList.contains("in_text_{$key}")&&(t.innerHTML=n),t.classList.contains("in_class_{$key}")&&t.classList.add(n),t.classList.contains("in_href_{$key}")){let e=t;e.href=e.href+n}return(t.classList.contains("val")||t.classList.contains("value"))&&(t.value=n),this._ALLOWED_ATTRS.forEach(function(e){["text","class","href","val","value"].indexOf(e)>=0||t.setAttribute(e,n)}),t}setMultiData(t,e=this.data){if("object"!=typeof e||!Object.keys(e).length)return t;let n=this,s=[];return t instanceof Element?s.push(t):s=Array.from(t),s.forEach(function(s){if(!s.classList.contains(this._HIDE_CLASS))return this.setData(t,e);let a;Array.isArray(e)?a=e:a[0]=e,a.forEach(function(t){let e=s.cloneNode(!0);s.parentElement.appendChild(e),n.setData(e,t)})},this),t}setData(t,n=this.data){if("object"!=typeof n||!Object.keys(n).length)return t;let s=n;return Array.isArray(n)&&(s=n[0]),Object.keys(s).forEach(function(a){s[a]instanceof Object?this.setMultiData(t.querySelectorAll("."+a),n[a]):e.isJson(n[a])?(n[a]=JSON.parse(n[a]),this.setMultiData(t.querySelectorAll("."+a),n[a])):(this.modifyElement(t,a,n[a]),t.querySelectorAll("[class*='_${prop}']").forEach(function(t){this.modifyElement(t,a,n[a])}))},this),t.classList.remove(this._HIDE_CLASS),t}}e.defaultSettings={_HIDE_CLASS:"clone",_ALLOWED_ATTRS:["class","text","val","value","id","src","title","href","data-object-src"],_DEFAULT_ERROR_CALLBACK:alert,_DEFAULT_HEADERS:{processData:!0},_DEFAULT_PARAMS:{XDEBUG_SESSION_START:"PHPSTORM"}},t.ApplyAjax=e}(Templater||(Templater={}));