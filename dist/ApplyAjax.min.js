"use strict";var Templater,__awaiter=this&&this.__awaiter||function(t,e,n,a){return new(n||(n=Promise))(function(s,r){function i(t){try{o(a.next(t))}catch(t){r(t)}}function c(t){try{o(a.throw(t))}catch(t){r(t)}}function o(t){t.done?s(t.value):new n(function(e){e(t.value)}).then(i,c)}o((a=a.apply(t,e||[])).next())})};!function(t){class e{constructor(t={}){this._DEFAULT_PARAMS={},this.data={},Object.keys(e.defaultSettings).forEach(function(n){this[n]=t[n]||e.defaultSettings[n]})}static isJson(t){try{if(JSON.parse(t)instanceof Object)return!0}catch(t){}return!1}request(t,e,n,a,s,r){return __awaiter(this,void 0,void 0,function*(){if(!t)return new Error("URL запроса не задан");let i=this,c=new URL(this._HOST+t),o=e instanceof FormData?e:new URLSearchParams(Object.assign({},this._DEFAULT_PARAMS,e));"GET"===n&&(Object.keys(o).forEach(t=>c.searchParams.append(t,o[t])),o=null);let l=s||this._DEFAULT_ERROR_CALLBACK,u=Object.assign({},this._DEFAULT_HEADERS,{method:n,body:o,credentials:"include",headers:new Headers({hash:location.hash.replace("#","")})},r);return fetch(c.toString(),u).then(function(t){return t.json().then(function(t){i.data=t,void 0!==t.error?l(t.error):t.redirect?window.location=t.redirect:a?a(t):alert("Запрос успешно выполнен")}),t},function(t){return l(`Произошла ошибка: ${t.message}`),t})})}ajaxSubmit(t,e,n,a,s){let r=this;return new Promise(function(n){return __awaiter(this,void 0,void 0,function*(){let a=new FormData(t);return e?e(a):(n(),a)})}).then(function(e){let i=r.request(t.action,e,"POST",n,a);return i.then(s),i},function(t){return a(t.message),t})}modifyElement(t,e,n){if(t.classList.contains("in_text_{$key}")&&(t.innerHTML=n),t.classList.contains("in_class_{$key}")&&t.classList.add(n),t.classList.contains("in_href_{$key}")){let e=t;e.href=e.href+n}return(t.classList.contains("val")||t.classList.contains("value"))&&(t.value=n),this._ALLOWED_ATTRS.forEach(function(e){["text","class","href","val","value"].indexOf(e)>=0||t.setAttribute(e,n)}),t}setMultiData(t,e=this.data){if("object"!=typeof e||!Object.keys(e).length)return t;let n=this,a=[];return t instanceof Element?a.push(t):a=Array.from(t),a.forEach(function(a){if(!a.classList.contains(this._HIDE_CLASS))return this.setData(t,e);let s;Array.isArray(e)?s=e:s[0]=e,s.forEach(function(t){let e=a.cloneNode(!0);a.parentElement.appendChild(e),n.setData(e,t)})},this),t}setData(t,n=this.data){if("object"!=typeof n||!Object.keys(n).length)return t;let a=n;return Array.isArray(n)&&(a=n[0]),Object.keys(a).forEach(function(s){a[s]instanceof Object?this.setMultiData(t.querySelectorAll("."+s),n[s]):e.isJson(n[s])?(n[s]=JSON.parse(n[s]),this.setMultiData(t.querySelectorAll("."+s),n[s])):(this.modifyElement(t,s,n[s]),t.querySelectorAll("[class*=_"+s+"]").forEach(function(t){this.modifyElement(t,s,n[s])}))},this),t.classList.remove(this._HIDE_CLASS),t}}e.defaultSettings={_HIDE_CLASS:"clone",_HOST:location.origin,_ALLOWED_ATTRS:["class","text","val","value","id","src","title","href","data-object-src"],_DEFAULT_ERROR_CALLBACK:alert,_DEFAULT_HEADERS:{processData:!0},_DEFAULT_PARAMS:{XDEBUG_SESSION_START:"PHPSTORM"}},t.ApplyAjax=e}(Templater||(Templater={}));